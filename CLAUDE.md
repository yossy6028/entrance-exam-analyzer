# Claude Code Instructions - 入試問題分析プロジェクト

## プロジェクト概要
このプロジェクトは国語の入試問題PDFから出題傾向と出典を自動抽出・分析するシステムです。

## 重要な制約事項
- OCRツールはGoogle Cloud Vision APIを使用
- 縦書きPDFの処理に対応
- 出力はExcel形式

## 技術スタック
- Python 3.8+
- Google Cloud Vision API
- pandas, openpyxl
- 画像処理: PIL/Pillow
- pdf2image（PDF→画像変換）

## 要件定義書・Todoリスト
- `/requirements_doc.md`に詳細な要件定義を保管

## 開発時の注意点
1. OCR結果の精度は100%ではないため、エラーハンドリングを適切に実装
2. 縦書きテキストの処理には特別な配慮が必要
3. 設問パターンの認識は正規表現を活用

## テスト実行
実装完了後は必ず以下を実行：
- サンプルPDFでの動作確認
- エラーケースのテスト（画質の悪いPDF等）

## Excelデータベース管理ルール

### 基本構造
- **1シート = 1学校**のルールを厳守
- シート名は学校名（例：開成中学校、渋渋中学校、桜蔭中学校）
- 各シートには複数年度のデータを時系列で格納

### 列構造
基本情報:
- 年度（整数型）
- 総設問数
- 総文字数
- 大問数

大問別情報（大問1〜大問n）:
- 大問n_ジャンル（小説・物語、評論・論説、随筆・エッセイ）
- 大問n_テーマ（人間関係・成長、自然・環境、社会・文化、科学・技術など）
- 大問n_著者
- 大問n_作品
- 大問n_設問数
- 大問n_文字数

設問タイプ別集計:
- 記述_問題数
- 選択_問題数
- 漢字・語句_問題数
- 抜き出し_問題数

### データ更新時の処理
1. 既存シートがある場合：同じ年度のデータがあれば更新、なければ追加
2. 新規学校の場合：新しいシートを作成してデータを追加
3. 年度順にソート（古い年度から新しい年度へ）
4. 不要なSheet1などは作成しない

### Excelファイルの破損対策
- データ更新時は必ず`if_sheet_exists='replace'`を使用
- 不要なシートや列を作成しない
- シンプルな構造を維持する

## OCRシステム

### Google Cloud Vision API
- 高精度な日本語OCR機能
- 縦書き文書の認識に対応
- 文書構造の自動解析
- Application Default Credentials (ADC) を使用した認証

### 使い方
```bash
# 認証設定（初回のみ）
gcloud auth application-default login

# アプリケーション実行
cd /Users/yoshiikatsuhiko/entrance_exam_analyzer
python3 main.py
```

### 注意事項
- Google Cloudプロジェクトの設定が必要
- Vision API の有効化が必要
- 適切な権限設定が必要